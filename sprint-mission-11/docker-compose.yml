version: "1.0"

services:
  # ğŸŒ Express ì„œë²„ ì„œë¹„ìŠ¤ ì •ì˜
  web:
    # í˜„ì¬ ë””ë ‰í† ë¦¬ì˜ Dockerfileì„ ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ì§€ ë¹Œë“œ
    build: .
    container_name: express_server
    ports:
      - "3000:3000"
    volumes:
      # 'express_uploads' ë³¼ë¥¨ì„ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì˜ '/usr/src/app/uploads' ê²½ë¡œì— ë§ˆìš´íŠ¸
      - express_uploads:/app/uploads

    environment:
      NODE_ENV: production
      # DB_HOSTëŠ” ì„œë¹„ìŠ¤ ì´ë¦„ì¸ 'db'ë¥¼ ì‚¬ìš© (Docker ë‚´ë¶€ DNS)
      DB_HOST: db
      DB_USER: Dokcer_User
      DB_PASSWORD: dockeruser
      DB_NAME: postgres
      DB_PORT: 5432

    # db ì„œë¹„ìŠ¤ê°€ web ì„œë¹„ìŠ¤ë³´ë‹¤ ë¨¼ì € ì‹œì‘ë˜ë„ë¡ ì„¤ì •
    depends_on:
      - db

  db:
    image: postgres:16-alpine # ê²½ëŸ‰ Postgres ì´ë¯¸ì§€ ì‚¬ìš©
    container_name: postgres_server_db
    restart: always # ì»¨í…Œì´ë„ˆ ì‹¤íŒ¨ ì‹œ ì¬ì‹œì‘
    volumes:
      - postgres_data:/var/lib/postgresql/data

    # ë°ì´í„°ë² ì´ìŠ¤ ì ‘ì† ì •ë³´ í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
    environment:
      POSTGRES_USER: MY_USER
      POSTGRES_PASSWORD: MY_PASSWORD
      POSTGRES_DB: MY_DB
